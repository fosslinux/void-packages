# Template file for 'maturin'
pkgname=maturin
version=0.8.1
revision=1
# https://github.com/PyO3/maturin/blob/master/src/target.rs#L71
archs="aarch64* armv7l* i686* x86_64*"
build_style=python3-module
hostmakedepends="cargo python3-setuptools python3-toml"
makedepends="rust rust-std llvm9"
short_desc="Build and publish crates with python bindings"
maintainer="fosslinux <fosslinux@aussies.space>"
license="Apache-2.0, MIT"
homepage="https://github.com/PyO3/maturin"
distfiles="https://github.com/PyO3/maturin/archive/v${version}.tar.gz"
checksum=b72a9885cda3ba4e53906a43aab101acb790622218ade6405b2ddf1ef1461f8f

post_install() {
	# Dynamic detection of python version
	PYTHON_VERSION=$(python3 --version | sed "s/^Python //" | rev | sed "s/^[0-9]*.//" | rev)
	mkdir -p "${DESTDIR}/usr/lib/python${PYTHON_VERSION}/site-packages/"
	mv "${DESTDIR}/maturin" "${DESTDIR}/usr/lib/python${PYTHON_VERSION}/site-packages/"
	vlicense license-mit
}
